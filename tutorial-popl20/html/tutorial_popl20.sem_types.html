<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<h1 class="libtitle">tutorial_popl20.sem_types</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">tutorial_popl20</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="tutorial_popl20.base.html#"><span class="id" title="library">base</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.heap_lang</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">proofmode</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">iris.base_logic.lib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">invariants</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab1"></a><h1 class="section">The domain of semantics types.</h1>
 Here we define the domain of semantics types as persistent Iris
    predicates over values. That is, to capture the semantics of a
    type <span class="inlinecode">τ</span>, we need to define what expressions belong to the
    semantics of <span class="inlinecode">τ</span>. We do this in two steps:

<div class="paragraph"> </div>

<ul class="doclist">
<li> We define what values semantically belong to type <span class="inlinecode">τ</span>. We do
        this in the file <span class="inlinecode"><span class="id" title="library">sem_type_formers</span></span>.

</li>
<li> We define the expressions that semantically belong to <span class="inlinecode">τ</span>. An
        expression <span class="inlinecode"><a class="idref" href="tutorial_popl20.typed.html#e"><span class="id" title="variable">e</span></a></span> semantically belongs to type <span class="inlinecode">τ</span> if <span class="inlinecode"><a class="idref" href="tutorial_popl20.typed.html#e"><span class="id" title="variable">e</span></a></span> is
        <i>safe</i>, and whenever it evaluates to a value <span class="inlinecode"><a class="idref" href="tutorial_popl20.sem_types.html#v"><span class="id" title="variable">v</span></a></span>, <span class="inlinecode"><a class="idref" href="tutorial_popl20.sem_types.html#v"><span class="id" title="variable">v</span></a></span>
        semantically belongs to <span class="inlinecode">τ</span>. We do this in the file <span class="inlinecode"><a class="idref" href="tutorial_popl20.sem_typed.html#sem_typed"><span class="id" title="section">sem_typed</span></a></span>.

</li>
</ul>

<div class="paragraph"> </div>

    Here we use Iris predicates as value semantics of types. The power
    of Iris's logic then allows us to define many semantic types
    including those that we need to interpret syntactic types for
    heap_lang, e.g., higher-order references, parametric polymorphism,
    etc.

<div class="paragraph"> </div>

    It is crucial for value semantics of types to be persistent
    predicates. This is due to the fact that our type system (as
    opposed to substructural type systems, e.g., affine type systems)
    allows values to be used multiple times. Hence, the fact that a
    value belongs to the semantics of a type must be duplicable which
    is guaranteed by persistence. 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;The&nbsp;domain&nbsp;of&nbsp;semantic&nbsp;types:&nbsp;persistent&nbsp;Iris&nbsp;predicates&nbsp;over&nbsp;values&nbsp;*)</span><br/>
<span class="id" title="keyword">Record</span> <a name="sem_ty"><span class="id" title="record">sem_ty</span></a> <span class="id" title="var">Σ</span> := <a name="SemTy"><span class="id" title="constructor">SemTy</span></a> {<br/>
&nbsp;&nbsp;<a name="sem_ty_car"><span class="id" title="projection">sem_ty_car</span></a> :&gt; <span class="id" title="inductive">val</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="abbreviation">iProp</span> <a class="idref" href="tutorial_popl20.sem_types.html#e15c0eb40e61adefe95778c26e7840f6"><span class="id" title="variable">Σ</span></a>;<br/>
&nbsp;&nbsp;<a name="sem_ty_persistent"><span class="id" title="projection">sem_ty_persistent</span></a> <span class="id" title="var">v</span> : <span class="id" title="class">Persistent</span> (<a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_car"><span class="id" title="method">sem_ty_car</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#v"><span class="id" title="variable">v</span></a>)<br/>
}.<br/>
<span class="id" title="var">Arguments</span> <a class="idref" href="tutorial_popl20.sem_types.html#SemTy"><span class="id" title="constructor">SemTy</span></a> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span>%<span class="id" title="var">I</span> {<span class="id" title="var">_</span>}.<br/>
<span class="id" title="var">Arguments</span> <a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_car"><span class="id" title="projection">sem_ty_car</span></a> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span> : <span class="id" title="tactic">simpl</span> <span class="id" title="var">never</span>.<br/>
<span class="id" title="keyword">Bind</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">sem_ty_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">sem_ty</span>.<br/>
<span class="id" title="keyword">Delimit</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">sem_ty_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">sem_ty</span>.<br/>
<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">sem_ty_persistent</span>.<br/>

<br/>
</div>

<div class="doc">
We show that the domain of semantic types forms a Complete Ordered
    Family of Equivalences (COFE). This is necessary mostly for
    enabling rewriting equivalent semantic types through Coq's setoid
    rewrite system. This part is mostly boilerplate.
 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;The&nbsp;COFE&nbsp;structure&nbsp;on&nbsp;semantic&nbsp;types&nbsp;*)</span><br/>
<span class="id" title="keyword">Section</span> <a name="sem_ty_cofe"><span class="id" title="section">sem_ty_cofe</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">Σ</span> : <span class="id" title="definition">gFunctors</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <a name="sem_ty_equiv"><span class="id" title="instance">sem_ty_equiv</span></a> : <span class="id" title="class">Equiv</span> (<a class="idref" href="tutorial_popl20.sem_types.html#sem_ty"><span class="id" title="record">sem_ty</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#3d2a807df9e0054611496b57de1fd9df"><span class="id" title="variable">Σ</span></a>) := <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">A</span> <span class="id" title="var">B</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <span class="id" title="var">w</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#w"><span class="id" title="variable">w</span></a> <span class="id" title="notation">≡</span> <a class="idref" href="tutorial_popl20.sem_types.html#B"><span class="id" title="variable">B</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#w"><span class="id" title="variable">w</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Instance</span> <a name="sem_ty_dist"><span class="id" title="instance">sem_ty_dist</span></a> : <span class="id" title="class">Dist</span> (<a class="idref" href="tutorial_popl20.sem_types.html#sem_ty"><span class="id" title="record">sem_ty</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#3d2a807df9e0054611496b57de1fd9df"><span class="id" title="variable">Σ</span></a>) := <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">n</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <span class="id" title="var">w</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#w"><span class="id" title="variable">w</span></a> <span class="id" title="notation">≡{</span><a class="idref" href="tutorial_popl20.sem_types.html#n"><span class="id" title="variable">n</span></a><span class="id" title="notation">}≡</span> <a class="idref" href="tutorial_popl20.sem_types.html#B"><span class="id" title="variable">B</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#w"><span class="id" title="variable">w</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a name="sem_ty_ofe_mixin"><span class="id" title="lemma">sem_ty_ofe_mixin</span></a> : <span class="id" title="record">OfeMixin</span> (<a class="idref" href="tutorial_popl20.sem_types.html#sem_ty"><span class="id" title="record">sem_ty</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#3d2a807df9e0054611496b57de1fd9df"><span class="id" title="variable">Σ</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> (<span class="id" title="lemma">iso_ofe_mixin</span> (<a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_car"><span class="id" title="projection">sem_ty_car</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.ssr.ssreflect.html#aed478b27f23b4f753c27c8ac393febc"><span class="id" title="notation">:</span></a> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#c41c566ddac4c1298b9e7dd2bae1c794"><span class="id" title="notation">→</span></a> <span class="id" title="inductive">val</span> <span class="id" title="notation">-</span><span class="id" title="notation">d</span><span class="id" title="notation">&gt;</span> <span class="id" title="var">_</span>)). <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Canonical</span> <span class="id" title="keyword">Structure</span> <span class="id" title="var">sem_tyO</span> := <span class="id" title="constructor">OfeT</span> (<a class="idref" href="tutorial_popl20.sem_types.html#sem_ty"><span class="id" title="record">sem_ty</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#3d2a807df9e0054611496b57de1fd9df"><span class="id" title="variable">Σ</span></a>) <a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_ofe_mixin"><span class="id" title="lemma">sem_ty_ofe_mixin</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="sem_ty_cofe"><span class="id" title="instance">sem_ty_cofe</span></a> : <span class="id" title="class">Cofe</span> <a class="idref" href="tutorial_popl20.sem_types.html#sem_tyO"><span class="id" title="definition">sem_tyO</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="lemma">iso_cofe_subtype'</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">λ</span></a> <span class="id" title="var">A</span> : <span class="id" title="inductive">val</span> <span class="id" title="notation">-</span><span class="id" title="notation">d</span><span class="id" title="notation">&gt;</span> <span class="id" title="abbreviation">iPropO</span> <a class="idref" href="tutorial_popl20.sem_types.html#3d2a807df9e0054611496b57de1fd9df"><span class="id" title="variable">Σ</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#bc1ad27deabe143d39d35abe6be2c1a4"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">∀</span></a> <span class="id" title="var">w</span><a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Unicode.Utf8_core.html#e15f3fa8414cf45e36c73a91b3f5f2c2"><span class="id" title="notation">,</span></a> <span class="id" title="class">Persistent</span> (<a class="idref" href="tutorial_popl20.sem_types.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#w"><span class="id" title="variable">w</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<a class="idref" href="tutorial_popl20.sem_types.html#SemTy"><span class="id" title="constructor">SemTy</span></a> <span class="id" title="var">_</span>) <a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_car"><span class="id" title="projection">sem_ty_car</span></a>)=&gt; //.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="lemma">limit_preserving_forall</span>=&gt; <span class="id" title="var">w</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="instance">bi.limit_preserving_Persistent</span>=&gt; <span class="id" title="var">n</span> ??.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="sem_ty_inhabited"><span class="id" title="instance">sem_ty_inhabited</span></a> : <span class="id" title="class">Inhabited</span> (<a class="idref" href="tutorial_popl20.sem_types.html#sem_ty"><span class="id" title="record">sem_ty</span></a> <a class="idref" href="tutorial_popl20.sem_types.html#3d2a807df9e0054611496b57de1fd9df"><span class="id" title="variable">Σ</span></a>) := <span class="id" title="constructor">populate</span> (<a class="idref" href="tutorial_popl20.sem_types.html#SemTy"><span class="id" title="constructor">SemTy</span></a> <span class="id" title="method">inhabitant</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="sem_ty_car_ne"><span class="id" title="instance">sem_ty_car_ne</span></a> <span class="id" title="var">n</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Classes.Morphisms.html#Proper"><span class="id" title="class">Proper</span></a> (<span class="id" title="definition">dist</span> <a class="idref" href="tutorial_popl20.sem_types.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="notation">(=)</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="definition">dist</span> <a class="idref" href="tutorial_popl20.sem_types.html#n"><span class="id" title="variable">n</span></a>) <a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_car"><span class="id" title="projection">sem_ty_car</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">A'</span> ? <span class="id" title="var">w</span> ? &lt;-. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <a name="sem_ty_car_proper"><span class="id" title="instance">sem_ty_car_proper</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Classes.Morphisms.html#Proper"><span class="id" title="class">Proper</span></a> (<span class="id" title="notation">(≡)</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="notation">(=)</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.10.2/stdlib//Coq.Classes.Morphisms.html#8dc5652698a6e16f72dd37bd17d3b973"><span class="id" title="notation">==&gt;</span></a> <span class="id" title="notation">(≡)</span>) <a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_car"><span class="id" title="projection">sem_ty_car</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">A'</span> ? <span class="id" title="var">w</span> ? &lt;-. <span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="tutorial_popl20.sem_types.html#sem_ty_cofe"><span class="id" title="section">sem_ty_cofe</span></a>.<br/>

<br/>
<span class="id" title="var">Arguments</span> <a class="idref" href="tutorial_popl20.sem_types.html#sem_tyO"><span class="id" title="definition">sem_tyO</span></a> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
